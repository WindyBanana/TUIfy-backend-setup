# Security & Environment Variables

## Critical Security Notice

**üö® NEVER COMMIT SECRETS TO GIT üö®**

This project is configured with security best practices. Please read this document carefully.

---

## How Environment Variables Are Managed

### ‚úÖ Safe: Local Development (.env.local)

Your **development secrets** are stored in `.env.local`:

```bash
# .env.local - LOCAL ONLY (never committed)
NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=pk_test_...
CLERK_SECRET_KEY=sk_test_...
OPENAI_API_KEY=sk-proj-...
```

**Storage:**
- ‚úÖ Stored on **your machine only**
- ‚úÖ Already in `.gitignore` (cannot be committed)
- ‚úÖ Not uploaded to GitHub
- ‚úÖ Not shared with team members

**Security:**
- Development keys have limited permissions
- Can be regenerated without affecting production
- Safe to use for testing and development

### ‚úÖ Safe: Production Secrets (Vercel Dashboard)

Your **production secrets** are set in the Vercel dashboard:

**How they're set:**
1. **Vercel API** (Automated during setup):
   - Launchify automatically sets production secrets via Vercel API
   - Secrets encrypted and stored in Vercel's infrastructure
   - Never stored in Git or local files

2. **Manual Entry** (For services without API):
   - Go to Vercel Dashboard ‚Üí Your Project ‚Üí Settings ‚Üí Environment Variables
   - Add production secrets manually
   - Encrypted and stored securely

**What gets set automatically:**
- ‚úÖ Clerk keys (via Vercel API)
- ‚úÖ Convex deployment keys (via Vercel API)
- ‚úÖ Axiom tokens (via Vercel API if configured)

**What you set manually:**
- Linear API keys (no automation available)
- AI API keys (OpenAI, Anthropic)
- Any custom secrets

**Storage:**
- ‚úÖ Encrypted in Vercel's infrastructure
- ‚úÖ Never visible in Git
- ‚úÖ Automatically injected into production builds
- ‚úÖ Separate from development secrets

### ‚úÖ Safe: Service CLIs

Some services manage secrets through their CLIs:

**Convex:**
```bash
npx convex dev           # Development deployment
npx convex deploy --prod # Production deployment
```
- Secrets managed by Convex cloud
- Deployment keys auto-generated
- Added to your `.env.local` automatically

**Axiom:**
```bash
axiom auth login         # Authenticate
axiom token create       # Generate token
```
- Tokens managed by Axiom cloud
- You copy token to `.env.local` manually

**Vercel:**
```bash
vercel                   # Deploy
vercel env pull          # Pull secrets to local
```
- Secrets managed in Vercel cloud
- Can sync to local `.env.local` for testing

---

## What Gets Committed to Git

### ‚úÖ SAFE to Commit:

```
‚úÖ src/                    # Your source code
‚úÖ public/                 # Static assets
‚úÖ package.json            # Dependencies
‚úÖ tsconfig.json           # TypeScript config
‚úÖ tailwind.config.ts      # Tailwind config
‚úÖ next.config.js          # Next.js config
‚úÖ .gitignore              # This protects secrets!
‚úÖ README.md               # Documentation
‚úÖ SECURITY.md             # This file
```

### ‚ùå NEVER Commit:

```
‚ùå .env                    # Contains secrets
‚ùå .env.local              # Development secrets
‚ùå .env.production         # Production secrets
‚ùå .env*.local             # Any local env files
‚ùå node_modules/           # Dependencies (large)
‚ùå .next/                  # Build output
‚ùå .vercel/                # Vercel config
‚ùå .convex/                # Convex deployment state
```

**Why?**
- Committing secrets exposes them to anyone with repository access
- Secrets in Git history are **permanent** (can't be truly removed)
- Attackers scan GitHub for accidentally committed secrets
- Compromised secrets can cost money and data

---

## Environment Variable Types

### 1. Public Variables (`NEXT_PUBLIC_*`)

These are **safe** to expose in the browser:

```bash
NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=pk_test_...
NEXT_PUBLIC_CONVEX_URL=https://...convex.cloud
NEXT_PUBLIC_APP_URL=https://yourapp.com
```

**Why?**
- Already visible in browser JavaScript
- Designed to be public (like API endpoints)
- No security risk if exposed

**Still don't commit them:**
- Different values for dev/staging/production
- Managed separately for each environment

### 2. Secret Variables

These must **never** be exposed:

```bash
CLERK_SECRET_KEY=sk_test_...           # NEVER expose
OPENAI_API_KEY=sk-proj-...             # NEVER expose
ANTHROPIC_API_KEY=sk-ant-...           # NEVER expose
DATABASE_URL=postgresql://...          # NEVER expose
```

**Why?**
- Grant full access to services
- Can be used to make API calls (costs money)
- Can access or modify data
- Security breach if exposed

---

## Security Checklist

Before pushing to GitHub, verify:

- [ ] `.env.local` is in `.gitignore`
- [ ] No API keys in source code
- [ ] No hardcoded secrets in configuration files
- [ ] `.gitignore` includes all env files
- [ ] Production secrets set in Vercel dashboard
- [ ] Development secrets only in `.env.local`

### Check Your Commit:

```bash
# Review what will be committed
git status

# Check for secrets in staged files
git diff --cached | grep -i "api.*key\|secret\|token"

# If you see secrets, DO NOT COMMIT!
git reset HEAD <file-with-secrets>
```

---

## What If I Accidentally Commit a Secret?

**üö® Act Immediately:**

1. **Rotate the secret:**
   - Generate a new API key/secret
   - Update `.env.local` with new value
   - Update Vercel dashboard with new value
   - Revoke the old (compromised) secret

2. **Don't just delete the file:**
   - Secrets remain in Git history
   - Anyone with history can still see them
   - Deleting from latest commit is not enough

3. **Clean Git history (advanced):**
   ```bash
   # Remove secret from ALL commits
   git filter-branch --force --index-filter \
     'git rm --cached --ignore-unmatch .env.local' \
     --prune-empty --tag-name-filter cat -- --all

   # Force push (dangerous - warns team first!)
   git push origin --force --all
   ```

4. **For serious leaks:**
   - Consider making repository private temporarily
   - Notify your team
   - Monitor for unauthorized access
   - Review service logs for suspicious activity

---

## Service-Specific Security

### Clerk (Authentication)

**Development:**
- `NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY` - Public, in browser
- `CLERK_SECRET_KEY` - Secret, server-side only

**Production:**
- Separate Clerk application
- Different keys for production
- Set in Vercel dashboard

**Webhooks:**
- `CLERK_WEBHOOK_SECRET` - Verifies webhook signatures
- Different for dev/production

### Convex (Database)

**Development:**
- `NEXT_PUBLIC_CONVEX_URL` - Public deployment URL
- `CONVEX_DEPLOY_KEY` - Managed by CLI

**Production:**
- Separate deployment
- Deployment URL set automatically
- Production deploy key generated by `npx convex deploy --prod`

### OpenAI / Anthropic (AI)

**Keys:**
- `OPENAI_API_KEY` - Secret, server-side only
- `ANTHROPIC_API_KEY` - Secret, server-side only

**Usage:**
- Only call from server components or API routes
- Never expose in client-side code
- Monitor usage in provider dashboards

### Linear (Project Management)

**Keys:**
- `LINEAR_API_KEY` - Secret, GraphQL access
- `LINEAR_TEAM_ID` - Not sensitive, but don't commit

**Setup:**
- No API automation available
- Manual entry required
- See SETUP_GUIDE.md

---

## Environment Variable Hierarchy

Next.js loads environment variables in this order:

1. `.env.local` - **Highest priority** (local dev)
2. `.env.development` - Development mode
3. `.env.production` - Production mode
4. `.env` - All environments

**Best Practice:**
- Use `.env.local` for all local development
- Don't commit any of these files
- Set production vars in Vercel dashboard

---

## Vercel Environment Variables

### How Vercel Handles Secrets:

**Three Environments:**
1. **Production** - Main branch deployments
2. **Preview** - Pull request deployments
3. **Development** - Local development (`vercel dev`)

**Setting Secrets:**

**Option 1: Vercel Dashboard (Manual)**
```
Project ‚Üí Settings ‚Üí Environment Variables
- Add variable name
- Add value
- Select environments (Production/Preview/Development)
- Click Save
```

**Option 2: Vercel API (Automated by Launchify)**
```bash
# Launchify automatically sets via API:
POST /v10/projects/{projectId}/env?upsert=true

# Sets:
- Clerk keys
- Convex URLs
- Axiom tokens
- Webhook secrets
```

**Option 3: Vercel CLI**
```bash
# Add secret
vercel env add CLERK_SECRET_KEY

# Pull to local .env.local
vercel env pull .env.local
```

---

## Multi-Environment Setup

### Development Environment

```bash
# .env.local
NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=pk_test_...
CLERK_SECRET_KEY=sk_test_...
NEXT_PUBLIC_CONVEX_URL=https://dev-abc123.convex.cloud
```

### Production Environment

```bash
# Vercel Dashboard ‚Üí Environment Variables
NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=pk_live_...
CLERK_SECRET_KEY=sk_live_...
NEXT_PUBLIC_CONVEX_URL=https://prod-xyz789.convex.cloud
```

**Why Separate?**
- Test changes without affecting live users
- Different API quotas/billing
- Isolated data (test vs. real)
- Safe experimentation

---

## Monitoring & Alerts

**Watch for:**
- Unexpected API usage spikes (compromised keys)
- Failed authentication attempts
- Unusual geographic access patterns
- Service billing anomalies

**Set up alerts:**
- Clerk Dashboard ‚Üí Monitoring
- OpenAI Usage Dashboard
- Vercel Analytics ‚Üí Security Events
- Axiom ‚Üí Set query alerts

---

## Best Practices

### ‚úÖ DO:

- Use `.env.local` for development secrets
- Set production secrets in Vercel dashboard
- Rotate secrets regularly (every 90 days)
- Use different secrets for dev/prod
- Add `.env*` to `.gitignore`
- Review Git diffs before committing
- Use environment-specific Clerk applications

### ‚ùå DON'T:

- Commit `.env` files to Git
- Share `.env.local` via email/Slack
- Use production secrets in development
- Hardcode secrets in source code
- Screenshot secrets (visible in images)
- Store secrets in issue trackers
- Copy secrets to documentation

---

## Questions?

**Need help?**
- Read `SETUP_GUIDE.md` for service-specific setup
- Check `README.md` for project overview
- Review `.env.local` comments for variable purposes
- See Vercel documentation for environment variables

**Security concerns?**
- Rotate compromised secrets immediately
- Review service access logs
- Enable two-factor authentication on all services
- Monitor billing for unusual activity

---

## Summary

**Key Takeaways:**
1. **Never commit `.env` files to Git**
2. ‚úÖ **Development secrets in `.env.local`** (local only)
3. ‚úÖ **Production secrets in Vercel dashboard** (encrypted)
4. **Rotate secrets regularly**
5. **Different secrets for dev/prod**
6. **Public variables (`NEXT_PUBLIC_*`) safe in browser**
7. **Secret variables server-side only**

Your security is our priority. Follow these practices and your application will be safe!
